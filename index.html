<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SEH-KADER-BUR </title>
    <style>
        body {
            margin: 0;
            background: #111;
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        #gameContainer {
            position: relative;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
        }
        canvas {
            background: #1a1a20;
            display: block;
            border: 2px solid #333;
        }
        /* UI Overlays */
        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
            box-sizing: border-box;
        }
        .top-bar {
            display: flex;
            justify-content: space-between;
            width: 100%;
            text-shadow: 1px 1px 4px black;
        }
        .hp-bar-container {
            width: 200px;
            background: #333;
            height: 20px;
            border: 2px solid white;
            position: relative;
        }
        .hp-fill {
            height: 100%;
            transition: width 0.2s;
        }
        #hp-blue { background: cyan; width: 100%; }
        #hp-red { background: #ff4444; width: 100%; }
        
        #mission-display {
            position: absolute;
            top: 50px;
            width: 100%;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        #mission-timer {
            font-size: 18px;
            color: white;
        }

        /* Modal for Upgrades */
        #upgrade-modal {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            border: 2px solid #ffd700;
            padding: 20px;
            text-align: center;
            pointer-events: auto;
            border-radius: 10px;
            z-index: 100;
            min-width: 400px;
        }
        #upgrade-modal h2 { margin-top: 0; color: #ffd700; }
        .upgrade-btn {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            background: #333;
            color: white;
            border: 1px solid #555;
            cursor: pointer;
            font-size: 18px;
            transition: 0.2s;
        }
        .upgrade-btn:hover {
            background: #444;
            border-color: cyan;
        }

        /* Dash Cooldown Indicators */
        .dash-indicator {
            position: absolute;
            font-size: 12px;
            font-weight: bold;
        }
    </style>
</head>
<body>

<div id="gameContainer">
    <canvas id="gameCanvas" width="1000" height="700"></canvas>
    
    <div id="ui-layer">
        <div class="top-bar">
            <div>
                <div style="color:cyan; margin-bottom:5px;">SEHO (WASD + Shift)</div>
                <div class="hp-bar-container"><div id="hp-blue" class="hp-fill"></div></div>
            </div>
            <div>
                <div style="text-align:right; color:#ff4444; margin-bottom:5px;">BURAK (Oklar + Enter)</div>
                <div class="hp-bar-container"><div id="hp-red" class="hp-fill"></div></div>
            </div>
        </div>
    </div>

    <div id="mission-display">
        <div id="mission-text">ISINMA TURU</div>
        <div id="mission-timer">30s</div>
    </div>

    <div id="upgrade-modal">
        <h2>GÃ–REV TAMAMLANDI!</h2>
        <p>YÃœKSELTME SEÃ‡:</p>
        <div id="upgrade-options"></div>
    </div>
</div>

<script>
/**
 * TETHERED SOULS
 * A Co-op Physics Survival Game
 */

// --- Audio System (Updated) ---
// BURAYA KOPYALADIÄžIN GITHUB RAW LINKINI YAPIÅžTIR
const CUSTOM_HEART_SOUND_URL = 'https://raw.githubusercontent.com/KULLANICI_ADI/REPO_ADI/main/sehburyeah.mp3'; 

const heartAudio = new Audio(CUSTOM_HEART_SOUND_URL);
heartAudio.volume = 0.5; // Ses seviyesi (0.0 ile 1.0 arasÄ±)

const AudioSys = {
    ctx: new (window.AudioContext || window.webkitAudioContext)(),
    playTone(freq, type, duration, vol=0.1) {
        if(this.ctx.state === 'suspended') this.ctx.resume();
        const osc = this.ctx.createOscillator();
        const gain = this.ctx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
        gain.gain.setValueAtTime(vol, this.ctx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + duration);
        osc.connect(gain);
        gain.connect(this.ctx.destination);
        osc.start();
        osc.stop(this.ctx.currentTime + duration);
    },
    playShoot() { this.playTone(400 + Math.random()*200, 'square', 0.1, 0.05); },
    playHit() { this.playTone(100, 'sawtooth', 0.2, 0.1); },
    playShield() { this.playTone(800, 'sine', 0.1, 0.1); },
    playCoin() { this.playTone(1200, 'sine', 0.1, 0.05); this.playTone(1800, 'sine', 0.1, 0.05); },
    
    // Eski melodi yerine MP3 Ã§alacak fonksiyon
    playLoveSound() {
        // EÄŸer ses zaten Ã§alÄ±yorsa baÅŸa sarÄ±p tekrar Ã§alar
        heartAudio.currentTime = 0;
        heartAudio.play().catch(e => console.log("Ses Ã§alma hatasÄ± (TarayÄ±cÄ± izni gerekebilir):", e));
    }
};

// --- Game Constants & State ---
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

const GAME = {
    width: 1000,
    height: 700,
    state: 'WARMUP', // WARMUP, PLAYING, UPGRADE, GAMEOVER
    difficulty: 1,
    time: 0,
    gameSpeed: 1.0, // For slow motion
    maxTetherDist: 350,
    gold: 0,
    mission: {
        active: false,
        type: null, // 'KILL_RED', 'KILL_BLUE', 'GOLD', 'SURVIVE'
        target: 0,
        current: 0,
        endTime: 0,
        failedDamage: false
    }
};

// --- Inputs ---
const keys = {};
window.addEventListener('keydown', e => keys[e.code] = true);
window.addEventListener('keyup', e => keys[e.code] = false);

// --- Entities ---
class Player {
    constructor(x, y, color, role) {
        this.x = x;
        this.y = y;
        this.color = color;
        this.role = role; // 'blue' or 'red'
        this.hp = 100;
        this.maxHp = 100;
        this.vx = 0;
        this.vy = 0;
        this.speedMult = 1.0;
        this.dashCooldown = 0;
        this.dashTimer = 0;
    }

    update(dt, partner) {
        if (this.dashCooldown > 0) this.dashCooldown -= dt;

        // Controls
        let dx = 0; 
        let dy = 0;
        
        if (this.role === 'blue') {
            if (keys['KeyW']) dy = -1;
            if (keys['KeyS']) dy = 1;
            if (keys['KeyA']) dx = -1;
            if (keys['KeyD']) dx = 1;
            // Dash Input
            if (keys['ShiftLeft'] && this.dashCooldown <= 0 && (dx!==0 || dy!==0)) {
                this.performDash(dx, dy, partner);
            }
        } else {
            if (keys['ArrowUp']) dy = -1;
            if (keys['ArrowDown']) dy = 1;
            if (keys['ArrowLeft']) dx = -1;
            if (keys['ArrowRight']) dx = 1;
            // Dash Input
            if (keys['Enter'] && this.dashCooldown <= 0 && (dx!==0 || dy!==0)) {
                this.performDash(dx, dy, partner);
            }
        }

        // Normalization
        if (dx !== 0 || dy !== 0) {
            const len = Math.sqrt(dx*dx + dy*dy);
            dx /= len; dy /= len;
        }

        // TENSION PHYSICS
        const dist = Math.hypot(this.x - partner.x, this.y - partner.y);
        
        // Inverse Tension: Closer = Faster
        // Map distance 0->Max to Speed 2.0->0.5
        let tensionMod = 1.0 + (1.0 - (dist / GAME.maxTetherDist)); 
        if(tensionMod < 0.5) tensionMod = 0.5;

        // Base Speed
        const speed = 250 * this.speedMult * tensionMod; 

        this.x += dx * speed * dt * GAME.gameSpeed;
        this.y += dy * speed * dt * GAME.gameSpeed;

        // Bound Clamping
        this.x = Math.max(15, Math.min(GAME.width-15, this.x));
        this.y = Math.max(15, Math.min(GAME.height-15, this.y));
    }

    performDash(dx, dy, partner) {
        this.dashCooldown = 8.0; // 8 seconds
        
        // 1. Lunge Forward
        this.x += dx * 80;
        this.y += dy * 80;
        
        // 2. Create Tension Particle
        particles.push(new Particle(this.x, this.y, this.color, 'KAÃ‡IÅž'));
        AudioSys.playTone(200, 'sawtooth', 0.1);

        // 3. Pull Partner (Snap) after delay
        setTimeout(() => {
            // Check if game is still running
            if (GAME.state === 'GAMEOVER') return;
            
            // Snap logic
            partner.x = this.x;
            partner.y = this.y;
            
            particles.push(new Particle(this.x, this.y, 'white', 'Finger SNAP!', 20));
            AudioSys.playTone(600, 'square', 0.1);
        }, 200);
    }

    draw(ctx) {
        ctx.fillStyle = this.color;
        ctx.beginPath();
        ctx.arc(this.x, this.y, 15, 0, Math.PI*2);
        ctx.fill();
        ctx.strokeStyle = 'white';
        ctx.lineWidth = 2;
        ctx.stroke();

        // Dash CD Ring
        if (this.dashCooldown > 0) {
            ctx.strokeStyle = `rgba(255,255,255,0.5)`;
            ctx.beginPath();
            ctx.arc(this.x, this.y, 20, 0, (this.dashCooldown/8.0) * Math.PI*2);
            ctx.stroke();
        }
    }
}

class Bullet {
    constructor(x, y, target, isRed) {
        this.x = x;
        this.y = y;
        this.isRed = isRed; // true = red bullet, false = blue bullet
        this.color = isRed ? '#ff4444' : 'cyan';
        this.radius = 6;
        
        const angle = Math.atan2(target.y - y, target.x - x);
        const speed = 100 + (GAME.difficulty * 10);
        this.vx = Math.cos(angle) * speed;
        this.vy = Math.sin(angle) * speed;
        this.life = 10; // seconds
    }

    update(dt) {
        this.x += this.vx * dt * GAME.gameSpeed;
        this.y += this.vy * dt * GAME.gameSpeed;
        this.life -= dt;
    }

    draw(ctx) {
        ctx.fillStyle = this.color;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI*2);
        ctx.fill();
    }
}

class Item {
    constructor(x, y, type) {
        this.x = x;
        this.y = y;
        this.type = type; // 'gold', 'heart_blue', 'heart_red', 'heart_green'
        this.timer = 15;
    }
    draw(ctx) {
        ctx.font = "20px Arial";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        if (this.type === 'gold') {
            ctx.fillStyle = "gold";
            ctx.fillText("ðŸ’°", this.x, this.y);
        } else {
            let c = (this.type === 'heart_blue') ? 'cyan' : (this.type === 'heart_red') ? 'red' : '#0f0';
            ctx.fillStyle = c;
            ctx.fillText("â™¥", this.x, this.y);
        }
    }
}

class Particle {
    constructor(x, y, color, text, size=14) {
        this.x = x;
        this.y = y;
        this.color = color;
        this.text = text;
        this.life = 1.0;
        this.size = size;
    }
    update(dt) {
        this.y -= 20 * dt;
        this.life -= dt;
    }
    draw(ctx) {
        ctx.globalAlpha = Math.max(0, this.life);
        ctx.fillStyle = this.color;
        ctx.font = `bold ${this.size}px Arial`;
        ctx.fillText(this.text, this.x, this.y);
        ctx.globalAlpha = 1.0;
    }
}

// --- Globals ---
const P1 = new Player(400, 350, 'cyan', 'blue');
const P2 = new Player(600, 350, '#ff4444', 'red');
let bullets = [];
let items = [];
let particles = [];
let lastTime = 0;
let loveModeTimer = 0;
let missionIntervalTimer = 0;

// --- Core Logic ---

function spawnEnemy() {
    // Spawn edges
    const side = Math.floor(Math.random() * 4);
    let x, y;
    if (side === 0) { x = Math.random()*GAME.width; y = -20; }
    if (side === 1) { x = Math.random()*GAME.width; y = GAME.height+20; }
    if (side === 2) { x = -20; y = Math.random()*GAME.height; }
    if (side === 3) { x = GAME.width+20; y = Math.random()*GAME.height; }

    const isRed = Math.random() > 0.5;
    // Red bullets chase red player, Blue chase blue (harder)
    // Or random? Prompt says "chasing players". 
    // Let's make Red Bullet chase Red Player (needs Blue to shield) and vice versa.
    const target = isRed ? P2 : P1; 
    
    bullets.push(new Bullet(x, y, target, isRed));
}

function checkCollisions() {
    // Bullets
    for (let i = bullets.length - 1; i >= 0; i--) {
        const b = bullets[i];
        
        // Hit Blue
        const distBlue = Math.hypot(b.x - P1.x, b.y - P1.y);
        if (distBlue < 21) {
            if (b.isRed) {
                // Red Bullet hits Blue -> SHIELDED
                bullets.splice(i, 1);
                particles.push(new Particle(P1.x, P1.y, 'cyan', 'engellendi'));
                AudioSys.playShield();
                if (GAME.mission.active && GAME.mission.type === 'KILL_RED') {
                    GAME.mission.current++;
                }
            } else {
                // Blue Bullet hits Blue -> OUCH
                P1.hp -= 10;
                bullets.splice(i, 1);
                particles.push(new Particle(P1.x, P1.y, 'red', '-10 can'));
                AudioSys.playHit();
                GAME.mission.failedDamage = true;
            }
            continue;
        }

        // Hit Red
        const distRed = Math.hypot(b.x - P2.x, b.y - P2.y);
        if (distRed < 21) {
            if (!b.isRed) {
                // Blue Bullet hits Red -> SHIELDED
                bullets.splice(i, 1);
                particles.push(new Particle(P2.x, P2.y, '#ff4444', 'engellendi'));
                AudioSys.playShield();
                if (GAME.mission.active && GAME.mission.type === 'KILL_BLUE') {
                    GAME.mission.current++;
                }
            } else {
                // Red Bullet hits Red -> OUCH
                P2.hp -= 10;
                bullets.splice(i, 1);
                particles.push(new Particle(P2.x, P2.y, 'red', '-10 Can'));
                AudioSys.playHit();
                GAME.mission.failedDamage = true;
            }
            continue;
        }
    }

    // Items
    for (let i = items.length - 1; i >= 0; i--) {
        const item = items[i];
        const dist1 = Math.hypot(item.x - P1.x, item.y - P1.y);
        const dist2 = Math.hypot(item.x - P2.x, item.y - P2.y);
        let picked = false;
        let picker = null;

        if (dist1 < 20) { picker = P1; picked = true; }
        else if (dist2 < 20) { picker = P2; picked = true; }

        if (picked) {
            if (item.type === 'gold') {
                GAME.gold++;
                particles.push(new Particle(item.x, item.y, 'gold', '+1 PARA'));
                if(GAME.mission.active && GAME.mission.type === 'GOLD') GAME.mission.current++;
                AudioSys.playCoin();
                items.splice(i, 1);
            } else {
                // Hearts
                let valid = false;
                if (item.type === 'heart_green') valid = true;
                if (item.type === 'heart_blue' && picker === P1) valid = true;
                if (item.type === 'heart_red' && picker === P2) valid = true;

                if (valid) {
                    picker.hp = Math.min(100, picker.hp + 25);
                    activateLoveMode();
                    items.splice(i, 1);
                }
            }
        }
    }
}

// ---activateLoveMode Fonksiyonunu Bul ve GÃ¼ncelle---
function activateLoveMode() {
    loveModeTimer = 2.0; // 2 saniye yavaÅŸlar
    GAME.gameSpeed = 0.3; // Slow motion
    bullets = []; // Mermileri temizle
    particles.push(new Particle(500, 350, 'pink', 'â™¥ SEHBURYEAH! â™¥', 30));
    
    // BURAYI DEÄžÄ°ÅžTÄ°RDÄ°K: ArtÄ±k MP3 Ã§alÄ±yor
    AudioSys.playLoveSound(); 
}

function updateMission(dt) {
    const elText = document.getElementById('mission-text');
    const elTimer = document.getElementById('mission-timer');

    if (!GAME.mission.active) {
        // Wait for next mission
        if (GAME.state === 'WARMUP' && GAME.time > 30) {
            GAME.state = 'PLAYING';
            startNewMission();
        } else if (GAME.state === 'WARMUP') {
            elText.innerHTML = "ISINMA TURU";
            elTimer.innerHTML = Math.ceil(30 - GAME.time) + "s";
        }
        return;
    }

    const timeLeft = GAME.mission.endTime - GAME.time;
    
    // UI Update
    let objStr = "";
    if (GAME.mission.type === 'KILL_RED') objStr = `BLUE: Destroy ${GAME.mission.target - GAME.mission.current} Red Bullets`;
    if (GAME.mission.type === 'KILL_BLUE') objStr = `RED: Destroy ${GAME.mission.target - GAME.mission.current} Blue Bullets`;
    if (GAME.mission.type === 'GOLD') objStr = `TEAM: Collect ${GAME.mission.target - GAME.mission.current} Gold`;
    if (GAME.mission.type === 'SURVIVE') objStr = `SURVIVE NO DAMAGE: ${Math.ceil(timeLeft)}s`;

    elText.innerHTML = objStr;
    elTimer.innerHTML = Math.ceil(timeLeft) + "s";

    // Check Logic
    let success = false;
    let fail = false;

    // Check Timeout Failure
    if (timeLeft <= 0) {
        if (GAME.mission.type === 'SURVIVE') {
            if (!GAME.mission.failedDamage) success = true;
            else fail = true;
        } else {
            fail = true;
        }
    }

    // Check Objective Success
    if (GAME.mission.type === 'KILL_RED' && GAME.mission.current >= GAME.mission.target) success = true;
    if (GAME.mission.type === 'KILL_BLUE' && GAME.mission.current >= GAME.mission.target) success = true;
    if (GAME.mission.type === 'GOLD' && GAME.mission.current >= GAME.mission.target) success = true;
    if (GAME.mission.type === 'SURVIVE' && GAME.mission.failedDamage) fail = true;

    if (fail) {
        // Punishment
        P1.hp = Math.floor(P1.hp / 2);
        P2.hp = Math.floor(P2.hp / 2);
        particles.push(new Particle(500, 350, 'red', 'MISSION FAILED: HP HALVED', 40));
        startNewMission(); // Retry/Next immediately
    } else if (success) {
        // Reward
        openUpgradeMenu();
    }
}

function startNewMission() {
    GAME.mission.active = true;
    GAME.mission.failedDamage = false;
    GAME.mission.current = 0;
    
    const types = ['KILL_RED', 'KILL_BLUE', 'GOLD', 'SURVIVE'];
    const type = types[Math.floor(Math.random() * types.length)];
    GAME.mission.type = type;

    const baseTime = 30; // Seconds

    if (type === 'KILL_RED') GAME.mission.target = 3 + GAME.difficulty;
    if (type === 'KILL_BLUE') GAME.mission.target = 3 + GAME.difficulty;
    if (type === 'GOLD') GAME.mission.target = 5 + Math.floor(GAME.difficulty/2);
    if (type === 'SURVIVE') GAME.mission.target = 0; // Just time

    GAME.mission.endTime = GAME.time + (type === 'SURVIVE' ? 20 : 30);
}

function openUpgradeMenu() {
    GAME.state = 'UPGRADE';
    GAME.difficulty++; // Increase difficulty
    
    const modal = document.getElementById('upgrade-modal');
    const container = document.getElementById('upgrade-options');
    container.innerHTML = '';
    
    // Pool
    const pool = [
        { txt: "Seho HIz +20%", apply: () => P1.speedMult += 0.2 },
        { txt: "Burak HIZ +20%", apply: () => P2.speedMult += 0.2 },
        { txt: "Seho Azami Can +20", apply: () => { P1.maxHp+=20; P1.hp+=20; } },
        { txt: "Burak Azami Can +20", apply: () => { P2.maxHp+=20; P2.hp+=20; } },
        { txt: "Ä°yileÅŸ", apply: () => { P1.hp = Math.min(P1.maxHp, P1.hp+50); P2.hp = Math.min(P2.maxHp, P2.hp+50); } },
        { txt: "Tension Mastery (Faster Max Stretch)", apply: () => { GAME.maxTetherDist += 50; } }
    ];

    // Pick 3 random
    for(let i=0; i<3; i++) {
        const u = pool[Math.floor(Math.random()*pool.length)];
        const btn = document.createElement('button');
        btn.className = 'upgrade-btn';
        btn.innerText = u.txt;
        btn.onclick = () => {
            u.apply();
            modal.style.display = 'none';
            GAME.state = 'PLAYING';
            lastTime = performance.now(); // Reset delta
            startNewMission();
        };
        container.appendChild(btn);
    }
    
    modal.style.display = 'block';
}

function checkTetherSnap() {
    const dist = Math.hypot(P1.x - P2.x, P1.y - P2.y);
    if (dist > GAME.maxTetherDist) {
        // Snap to midpoint
        const midX = (P1.x + P2.x) / 2;
        const midY = (P1.y + P2.y) / 2;
        P1.x = midX - 20; P1.y = midY;
        P2.x = midX + 20; P2.y = midY;
        
        particles.push(new Particle(midX, midY, 'white', 'Kader BirleÅŸti', 25));
        AudioSys.playTone(150, 'square', 0.2);
    }
}

// --- Main Loop ---

function gameLoop(timestamp) {
    if (!lastTime) lastTime = timestamp;
    const dt = (timestamp - lastTime) / 1000;
    lastTime = timestamp;

    if (GAME.state === 'UPGRADE') {
        requestAnimationFrame(gameLoop);
        return;
    }

    if (GAME.state === 'GAMEOVER') {
        ctx.fillStyle = 'rgba(0,0,0,0.1)';
        ctx.fillRect(0,0,GAME.width, GAME.height);
        ctx.fillStyle = 'red';
        ctx.font = '60px Arial';
        ctx.fillText("OYUN BÄ°TTÄ°", 350, 350);
        return;
    }

    // Logic
    GAME.time += dt;

    // Love Mode Timer
    if (loveModeTimer > 0) {
        loveModeTimer -= dt;
        if (loveModeTimer <= 0) GAME.gameSpeed = 1.0;
    }

    // Spawning
    if (Math.random() < (0.02 + (GAME.difficulty * 0.005)) * GAME.gameSpeed) {
        spawnEnemy();
    }
    // Items
    if (Math.random() < 0.005) {
        items.push(new Item(Math.random()*GAME.width, Math.random()*GAME.height, 'gold'));
    }
    if (Math.random() < 0.002) {
        const t = Math.random();
        let type = 'heart_green';
        if (t < 0.33) type = 'heart_blue';
        else if (t < 0.66) type = 'heart_red';
        items.push(new Item(Math.random()*GAME.width, Math.random()*GAME.height, type));
    }

    // Update Entities
    P1.update(dt, P2);
    P2.update(dt, P1);
    checkTetherSnap();

    bullets.forEach(b => b.update(dt));
    particles.forEach(p => p.update(dt));
    
    // Cleanup
    bullets = bullets.filter(b => b.life > 0 && b.x > -50 && b.x < GAME.width+50 && b.y > -50 && b.y < GAME.height+50);
    particles = particles.filter(p => p.life > 0);
    items.forEach(i => i.timer -= dt);
    
    checkCollisions();
    updateMission(dt);

    if (P1.hp <= 0 && P2.hp <= 0) GAME.state = 'GAMEOVER';

    // --- Draw ---
    ctx.clearRect(0, 0, GAME.width, GAME.height);

    // Tether
    ctx.strokeStyle = `rgba(255, 255, 255, ${0.2 + (1.0 - (Math.hypot(P1.x-P2.x, P1.y-P2.y)/GAME.maxTetherDist))})`;
    ctx.lineWidth = 4;
    ctx.beginPath();
    ctx.moveTo(P1.x, P1.y);
    ctx.bezierCurveTo((P1.x+P2.x)/2, (P1.y+P2.y)/2 + 50, (P1.x+P2.x)/2, (P1.y+P2.y)/2 - 50, P2.x, P2.y);
    ctx.stroke();

    items.forEach(i => i.draw(ctx));
    P1.draw(ctx);
    P2.draw(ctx);
    bullets.forEach(b => b.draw(ctx));
    particles.forEach(p => p.draw(ctx));

    // Update HP UI
    document.getElementById('hp-blue').style.width = (P1.hp/P1.maxHp)*100 + "%";
    document.getElementById('hp-red').style.width = (P2.hp/P2.maxHp)*100 + "%";

    requestAnimationFrame(gameLoop);
}

requestAnimationFrame(gameLoop);

</script>
</body>
</html>
