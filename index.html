<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHRBRK | Time Attack Hub</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- TEMEL DEÄžÄ°ÅžKENLER --- */
        :root {
            --bg-color: #0f1923; 
            --bg-gradient: radial-gradient(circle at center, #1f2731 0%, #0f1923 100%);
            --val-red: #ff4655;
            --val-white: #ece8e1;
            --val-dark: #0f1923;
            --cyber-blue: #00ffff;
            --text-primary: #ece8e1;
            --text-secondary: #8b9bb4;
            --font-head: 'Orbitron', sans-serif;
            --font-body: 'Rajdhani', sans-serif;
            --sidebar-width: 350px;
            
            /* VarsayÄ±lan Crosshair DeÄŸerleri */
            --cross-color: #00ff00;
            --cross-size: 20px;
        }

        [data-theme="light"] {
            --bg-color: #e0e0e0;
            --bg-gradient: radial-gradient(circle at center, #ffffff 0%, #d1d1d1 100%);
            --val-white: #111;
            --text-primary: #222;
            --text-secondary: #555;
            --val-dark: #f5f5f5;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg-color);
            background-image: var(--bg-gradient);
            color: var(--text-primary);
            font-family: var(--font-body);
            overflow: hidden; 
            height: 100vh;
            user-select: none;
            transition: background 0.5s ease;
        }

        /* --- UI GÄ°ZLEME SINIFI --- */
        .ui-hidden {
            opacity: 0 !important;
            pointer-events: none !important;
            visibility: hidden !important;
        }

        /* --- ARKA PLAN --- */
        #parallax-bg {
            position: fixed; top: -5%; left: -5%; width: 110%; height: 110%;
            background: url('https://images.unsplash.com/photo-1546443046-ed1ce6ffd1e9?auto=format&fit=crop&w=2070&q=80') center/cover;
            opacity: 0.10; pointer-events: none; z-index: 0;
            filter: blur(4px); transition: transform 0.1s linear;
        }

        /* --- CUSTOM CROSSHAIR --- */
        #custom-cursor {
            position: fixed;
            top: 0; left: 0;
            pointer-events: none; /* TÄ±klamayÄ± engelleme, arkaya geÃ§ir */
            transform: translate(-50%, -50%);
            z-index: 10000;
            display: none; /* BaÅŸlangÄ±Ã§ta gizli */
        }
        .ch-h, .ch-v {
            position: absolute;
            background-color: var(--cross-color);
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 2px rgba(0,0,0,0.8);
        }
        .ch-h { width: var(--cross-size); height: 2px; }
        .ch-v { width: 2px; height: var(--cross-size); }
        .ch-dot {
            position: absolute; width: 4px; height: 4px;
            background: red; border-radius: 50%;
            top: 50%; left: 50%; transform: translate(-50%, -50%);
        }

        /* Oyun Modunda GerÃ§ek Mouse'u Gizle */
        body.game-cursor-hidden {
            cursor: none;
        }
        body.game-cursor-hidden .aim-target, 
        body.game-cursor-hidden button {
            cursor: none !important;
        }

        /* --- OYUN ALANI --- */
        #game-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 5; pointer-events: none;
        }

        /* ODAK MODU AKTÄ°FKEN */
        body.focus-mode #game-layer {
            z-index: 9000;
            pointer-events: auto;
            background: rgba(0,0,0,0.85); /* Daha koyu odaklanma */
        }

        .aim-target {
            position: absolute; width: 70px; height: 70px;
            background: radial-gradient(circle, var(--val-red) 40%, transparent 70%);
            border: 2px solid var(--val-red); border-radius: 50%;
            box-shadow: 0 0 15px var(--val-red); 
            pointer-events: auto;
            opacity: 0.8;
            /* Animation JS tarafÄ±ndan set edilecek (zorluÄŸa gÃ¶re) */
            display: flex; justify-content: center; align-items: center;
        }
        
        @keyframes spawnPulse { 
            0% { transform: scale(0); opacity: 0; } 
            10% { transform: scale(1); opacity: 1; } 
            80% { transform: scale(1); opacity: 1; } 
            100% { transform: scale(0); opacity: 0; } 
        }

        .hit-effect { position: absolute; width: 80px; height: 80px; border: 2px solid #fff; border-radius: 50%; animation: hitAnim 0.2s ease-out forwards; pointer-events: none; z-index: 9002; }
        @keyframes hitAnim { 0% { transform: scale(0.5); opacity: 1; border-width: 5px; } 100% { transform: scale(1.5); opacity: 0; border-width: 0px; } }

        /* --- OYUN HUD & EKRANLARI --- */
        #game-hud {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            display: flex; gap: 40px; z-index: 9500; pointer-events: none;
            display: none; 
        }
        .hud-box {
            background: rgba(0,0,0,0.6); border: 1px solid var(--val-red);
            padding: 10px 30px; color: #fff; font-family: var(--font-head);
            font-size: 1.5rem; text-shadow: 0 0 10px var(--val-red);
            clip-path: polygon(10px 0, 100% 0, 100% 100%, 0 100%, 0 10px);
        }

        #start-screen, #result-screen {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            z-index: 9600; text-align: center; display: none; width: 100%; pointer-events: none;
        }
        /* start-screen iÃ§indeki etkileÅŸimli alan */
        .start-content {
            pointer-events: auto;
            display: inline-flex; flex-direction: column; gap: 15px;
            background: rgba(15, 25, 35, 0.95); padding: 40px;
            border: 1px solid var(--val-red);
            align-items: center;
        }
        
        .big-btn {
            font-family: var(--font-head); font-size: 2rem; padding: 20px 60px;
            background: var(--val-red); color: #fff; border: none; cursor: pointer;
            clip-path: polygon(20px 0, 100% 0, 100% 100%, 0 100%, 0 20px);
            transition: 0.3s; box-shadow: 0 0 30px rgba(255, 70, 85, 0.4);
            text-transform: uppercase; letter-spacing: 5px;
        }
        .big-btn:hover { background: #fff; color: var(--val-red); transform: scale(1.05); }

        .result-box {
            background: rgba(15, 25, 35, 0.95); padding: 40px; border: 2px solid var(--val-red);
            clip-path: polygon(20px 0, 100% 0, 100% calc(100% - 20px), calc(100% - 20px) 100%, 0 100%, 0 20px);
            display: inline-flex; flex-direction: column; gap: 20px; width: 400px;
            pointer-events: auto;
        }
        .result-title { font-size: 2rem; font-family: var(--font-head); color: var(--val-white); }
        .result-score { font-size: 4rem; font-family: var(--font-head); color: var(--val-red); font-weight: bold; }
        
        .action-btn {
            padding: 12px; background: transparent; border: 1px solid #fff; color: #fff;
            cursor: pointer; font-family: var(--font-head); transition: 0.3s;
        }
        .action-btn:hover { background: #fff; color: #000; }
        .share-btn { background: var(--cyber-blue); border-color: var(--cyber-blue); color: #000; font-weight: bold; }
        .share-btn:hover { background: #fff; }

        /* SETTINGS UI */
        .settings-row {
            display: flex; gap: 20px; align-items: center; justify-content: center;
            margin-top: 10px; padding: 15px; border-top: 1px solid #444; width: 100%;
        }
        .setting-item { display: flex; flex-direction: column; gap: 5px; text-align: left; }
        .setting-label { font-size: 0.8rem; color: #aaa; font-family: var(--font-head); }
        .setting-input { 
            background: #222; color: white; border: 1px solid #555; padding: 5px;
            font-family: var(--font-body);
        }
        input[type="range"] { accent-color: var(--val-red); }


        /* --- HEADER --- */
        .header-container { position: fixed; top: 0; left: 0; width: 100%; padding: 20px 40px; z-index: 100; display: flex; justify-content: space-between; align-items: center; transition: opacity 0.5s; }
        .logo { font-family: var(--font-head); font-size: 2.5rem; color: var(--val-white); font-weight: 900; letter-spacing: 5px; text-shadow: 0 0 15px var(--val-red); cursor: pointer; }
        .top-menu { display: flex; gap: 20px; align-items: center; }
        .menu-link { color: var(--text-secondary); text-decoration: none; font-family: var(--font-head); font-size: 0.8rem; letter-spacing: 2px; transition: 0.3s; }
        .menu-link:hover { color: var(--val-white); }
        .auth-btn { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: var(--val-white); padding: 8px 20px; font-family: var(--font-head); font-size: 0.8rem; cursor: pointer; transition: 0.3s; clip-path: polygon(10px 0, 100% 0, 100% 100%, 0 100%, 0 10px); }
        .auth-btn:hover { background: var(--val-white); color: #000; }
        .auth-btn.primary { background: var(--val-red); border-color: var(--val-red); }
        .auth-btn.primary:hover { background: #ff7070; color: #fff; }
        #user-profile { display: none; align-items: center; gap: 15px; }
        .user-name { color: var(--cyber-blue); font-family: var(--font-head); font-size: 0.9rem; }
        .logout-icon { cursor: pointer; color: var(--val-red); font-size: 1.1rem; transition: 0.3s; }

        /* --- LOBBY --- */
        .lobby-wrapper {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            display: flex; flex-direction: column; align-items: center; gap: 30px;
            z-index: 10; transition: opacity 0.5s;
        }
        .lobby-container { display: flex; gap: 15px; height: 50vh; width: 80vw; justify-content: center; align-items: center; perspective: 1000px; pointer-events: none; }
        .lobby-card { pointer-events: auto; flex: 1; height: 100%; max-width: 250px; position: relative; cursor: pointer; transition: transform 0.4s, filter 0.4s; clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px); background: var(--val-dark); border: 1px solid rgba(255,255,255,0.1); backdrop-filter: blur(10px); overflow: hidden; display: flex; flex-direction: column; justify-content: flex-end; }
        .lobby-card:hover { transform: scale(1.1) translateY(-20px); z-index: 20; border-color: var(--val-red); box-shadow: 0 0 30px rgba(255, 70, 85, 0.3); }
        .lobby-card:not(:hover) { filter: brightness(0.7); }
        .card-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-size: cover; background-position: center; transition: transform 0.5s; z-index: -1; }
        .lobby-card:hover .card-bg { transform: scale(1.1); }
        .c1 .card-bg { background-image: url('https://cmsassets.rgpub.io/sanity/images/dsfx7636/news/e435c3378b7999a3338b408dbb5da8ba63f91150-616x822.png?accountingTag=VAL?auto=format&fit=fill&q=80&w=352'); }
        .c2 .card-bg { background-image: url('https://cmsassets.rgpub.io/sanity/images/dsfx7636/news/477284dfe402a85abcf6b07512bcd6f01c8fe60e-616x822.png?accountingTag=VAL?auto=format&fit=fill&q=80&w=352'); }
        .c3 .card-bg { background-image: url('https://cmsassets.rgpub.io/sanity/images/dsfx7636/news/14145d7bf9be17afa80c04ee4fbe200076cc1769-616x822.png?accountingTag=VAL?auto=format&fit=fill&q=80&w=352'); }
        .c4 .card-bg { background-image: url('https://cmsassets.rgpub.io/sanity/images/dsfx7636/news/7cb513c9b3eae3286449776e85753138436d553c-616x822.png?accountingTag=VAL?auto=format&fit=fill&q=80&w=352'); }
        .c5 .card-bg { background-image: url('https://cmsassets.rgpub.io/sanity/images/dsfx7636/news/47387e354c34d51b84066bc47af3c5755b92b9c5-616x822.png?accountingTag=VAL?auto=format&fit=fill&q=80&w=352'); }
        .card-info { background: linear-gradient(to top, rgba(0,0,0,0.9), transparent); padding: 20px; text-align: center; width: 100%; }
        .card-title { font-family: var(--font-head); font-size: 1.2rem; color: var(--val-white); }
        .card-subtitle { font-size: 0.8rem; color: var(--val-red); margin-top: 5px; font-weight: bold; }

        /* ODAK MODU BUTONU */
        #game-mode-toggle {
            padding: 12px 40px; background: rgba(0,0,0,0.6);
            border: 1px solid var(--val-red); color: var(--val-white);
            font-family: var(--font-head); letter-spacing: 2px;
            cursor: pointer; clip-path: polygon(10px 0, 100% 0, 100% 100%, 0 100%, 0 10px);
            transition: 0.3s; pointer-events: auto; margin-top: 20px; z-index: 500;
        }
        #game-mode-toggle:hover { background: var(--val-red); color: #fff; box-shadow: 0 0 20px var(--val-red); }

        /* --- SOHBET Ã‡EKMECESÄ° --- */
        .sidebar-trigger { 
            position: fixed; left: 0; top: 50%; transform: translateY(-50%); 
            width: 40px; height: 200px; 
            background: rgba(0,0,0,0.6); border: 1px solid rgba(255,255,255,0.1); border-left: none; 
            display: flex; align-items: center; justify-content: center; cursor: pointer; 
            z-index: 6000; transition: 0.3s; 
            clip-path: polygon(0 0, 100% 10%, 100% 90%, 0 100%);
        }
        .sidebar-trigger:hover { background: var(--val-red); width: 50px; }
        .sidebar-text { writing-mode: vertical-rl; transform: rotate(180deg); font-family: var(--font-head); letter-spacing: 3px; color: #fff; }

        #chat-sidebar { 
            position: fixed; top: 0; left: -400px; width: var(--sidebar-width); height: 100%; 
            background: rgba(15, 25, 35, 0.95); border-right: 1px solid var(--val-red); backdrop-filter: blur(20px); 
            z-index: 6001; transition: left 0.4s; display: flex; flex-direction: column; 
        }
        #chat-sidebar.active { left: 0; }
        
        .chat-header { padding: 20px; background: rgba(255, 70, 85, 0.1); border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-between; align-items: center; }
        .chat-channels { display: flex; gap: 5px; padding: 10px; overflow-x: auto; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .channel-btn { flex: 1; background: transparent; border: 1px solid #555; color: #aaa; cursor: pointer; padding: 5px; font-family: var(--font-head); font-size: 0.7rem; transition: 0.3s; }
        .channel-btn.active, .channel-btn:hover { background: var(--val-red); color: #fff; border-color: var(--val-red); }

        .chat-messages { flex: 1; padding: 20px; overflow-y: auto; color: #ddd; font-size: 0.9rem; display: flex; flex-direction: column; gap: 10px;}
        .msg-line { padding: 8px 12px; background: rgba(255,255,255,0.05); border-left: 2px solid #555; }
        .msg-line.mine { border-left-color: var(--cyber-blue); background: rgba(0, 255, 255, 0.05); }
        .msg-user { font-size: 0.75rem; color: var(--val-red); font-weight: bold; margin-bottom: 3px; display:flex; justify-content:space-between;}
        .chat-input-area { padding: 20px; border-top: 1px solid rgba(255,255,255,0.1); position: relative; }
        .chat-input { width: 100%; padding: 12px; background: rgba(0,0,0,0.3); border: 1px solid #555; color: #fff; outline: none; font-family: var(--font-body); }

        /* AUTH BOX */
        .auth-modal-wrapper { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 7000; display: none; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .auth-box { background: rgba(20, 25, 35, 0.95); width: 350px; padding: 40px; border: 1px solid var(--val-red); position: relative; clip-path: polygon(20px 0, 100% 0, 100% calc(100% - 20px), calc(100% - 20px) 100%, 0 100%, 0 20px); text-align: center; }
        .auth-input { width: 100%; padding: 12px; margin-bottom: 15px; background: rgba(0,0,0,0.5); border: 1px solid #444; color: #fff; }
        .auth-submit-btn { width: 100%; padding: 12px; background: var(--val-red); color: #fff; border: none; font-family: var(--font-head); cursor: pointer; clip-path: polygon(10px 0, 100% 0, 100% 100%, 0 100%, 0 10px); }
        .google-btn { width: 100%; padding: 12px; margin-top: 10px; background: #fff; color: #333; border: none; font-family: var(--font-head); cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; clip-path: polygon(10px 0, 100% 0, 100% 100%, 0 100%, 0 10px); }
        .close-sidebar-btn, .auth-close { background: transparent; border: none; color: #fff; cursor: pointer; }

        /* VIDEO DRAWER */
        .video-trigger { position: fixed; bottom: 0; left: 50%; transform: translateX(-50%); padding: 10px 40px; background: rgba(0,0,0,0.8); border: 1px solid var(--val-red); border-bottom: none; color: var(--val-white); font-family: var(--font-head); cursor: pointer; z-index: 3000; clip-path: polygon(10% 0, 90% 0, 100% 100%, 0 100%); transition: 0.3s;}
        #video-drawer { position: fixed; bottom: -100vh; left: 0; width: 100%; height: 90vh; background: rgba(10, 12, 16, 0.98); z-index: 3000; transition: bottom 0.6s; display: flex; flex-direction: column; align-items: center; justify-content: center; border-top: 2px solid var(--val-red); }
        #video-drawer.active { bottom: 0; }
        .carousel-container { width: 100%; height: 60vh; perspective: 1500px; display: flex; justify-content: center; align-items: center; }
        .carousel { position: relative; width: 600px; height: 350px; transform-style: preserve-3d; transition: transform 0.6s; }
        .carousel-item { position: absolute; width: 600px; height: 350px; left: 0; top: 0; background: #000; border: 2px solid #333; transition: 0.6s; opacity: 0.3; filter: grayscale(100%); pointer-events: none; }
        .carousel-item.active { opacity: 1; filter: grayscale(0%); pointer-events: auto; border-color: var(--val-red); box-shadow: 0 0 50px rgba(255, 70, 85, 0.2); }
        .video-overlay { position: absolute; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.6); display: flex; justify-content: center; align-items: center; font-size: 3rem; color: #fff; cursor: pointer; z-index: 5; transition: 0.3s; }
        .page-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(10,10,15,0.95); z-index: 4000; display: flex; flex-direction: column; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: 0.4s; }
        .page-modal.active { opacity: 1; pointer-events: auto; }
        .blur-bg { filter: blur(8px); transition: 0.3s; }

        /* Oyun Modu Ã‡Ä±kÄ±ÅŸ Butonu */
        #exit-game-mode {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            padding: 10px 30px; background: #333; color: #aaa;
            font-family: var(--font-head); cursor: pointer; border: 1px solid #555;
            clip-path: polygon(10px 0, 100% 0, 100% 100%, 0 100%, 0 10px);
            z-index: 10000; display: none;
        }
        #exit-game-mode:hover { background: #fff; color: #000; }

    </style>
</head>
<body>

    <div id="parallax-bg"></div>
    
    <div id="custom-cursor">
        <div class="ch-h"></div>
        <div class="ch-v"></div>
        <div class="ch-dot"></div>
    </div>

    <div id="game-layer"></div>
    
    <div id="game-hud">
        <div class="hud-box">SÃœRE: <span id="time-val">30</span></div>
        <div class="hud-box">SKOR: <span id="score-val">0</span></div>
    </div>

    <div id="start-screen">
        <div class="start-content">
            <h2 style="margin:0; font-family:var(--font-head); color:var(--val-white); letter-spacing:3px;">ODAK MODU</h2>
            
            <button class="big-btn" onclick="startGame()">BAÅžLAT</button>
            
            <div class="settings-row">
                <div class="setting-item">
                    <span class="setting-label">ZORLUK</span>
                    <select id="diff-select" class="setting-input" onchange="saveSettings()">
                        <option value="1200">KOLAY</option>
                        <option value="985" selected>ORTA</option>
                        <option value="875">ZOR</option>
                        <option value="725">UZMAN</option>
                        <option value="625">LAVUK</option>
                    </select>
                </div>
                <div class="setting-item">
                    <span class="setting-label">CROSS RENGÄ°</span>
                    <input type="color" id="cross-color-input" class="setting-input" value="#00ff00" oninput="updateCrosshairSettings()">
                </div>
                <div class="setting-item">
                    <span class="setting-label">BOYUT</span>
                    <input type="range" id="cross-size-input" min="10" max="60" value="20" oninput="updateCrosshairSettings()">
                </div>
            </div>
            <div style="font-size:0.7rem; color:#666;">AyarlarÄ±n otomatik kaydedilir.</div>
        </div>
    </div>

    <div id="result-screen">
        <div class="result-box">
            <div class="result-title">SÃœRE BÄ°TTÄ°</div>
            <div class="result-score" id="final-score">0</div>
            <button class="action-btn share-btn" onclick="shareScore()">SKORU PAYLAÅž</button>
            <button class="action-btn" onclick="startGame()">TEKRAR OYNA</button>
            <button class="action-btn" onclick="toggleGameMode()">Ã‡IKIÅž</button>
        </div>
    </div>

    <button id="exit-game-mode" onclick="toggleGameMode()">ARAYÃœZÃœ GÃ–STER</button>

    <div class="header-container" id="main-header">
        <div class="logo">SHRBRK</div>
        <div class="top-menu">
            <a href="https://kick.com/shrbrk" class="menu-link">KICK</a>
            <a href="https://instagram.com/shrbrkofficial" class="menu-link">INSTAGRAM</a>
            <div id="auth-buttons" style="display:flex; gap:10px;">
                <button class="auth-btn" onclick="openAuth('login')">GÄ°RÄ°Åž YAP</button>
                <button class="auth-btn primary" onclick="openAuth('register')">KAYIT OL</button>
            </div>
            <div id="user-profile">
                <span class="user-name" id="display-name">KULLANICI</span>
                <i class="fas fa-sign-out-alt logout-icon" onclick="logoutUser()" title="Ã‡Ä±kÄ±ÅŸ Yap"></i>
            </div>
        </div>
    </div>

    <div id="auth-modal-wrapper" class="auth-modal-wrapper">
        <div id="box-login" class="auth-box" style="display:none;">
            <i class="fas fa-times auth-close" onclick="closeAuth()"></i>
            <div class="auth-title">SÄ°STEME GÄ°RÄ°Åž</div>
            <input type="email" id="login-email" class="auth-input" placeholder="E-Posta">
            <input type="password" id="login-pass" class="auth-input" placeholder="Åžifre">
            <button class="auth-submit-btn" onclick="handleLoginEmail()">GÄ°RÄ°Åž YAP</button>
            <button class="google-btn" onclick="handleLoginGoogle()"><i class="fab fa-google"></i> GOOGLE</button>
        </div>
        <div id="box-register" class="auth-box" style="display:none;">
            <i class="fas fa-times auth-close" onclick="closeAuth()"></i>
            <div class="auth-title">YENÄ° AJAN KAYDI</div>
            <input type="text" id="reg-name" class="auth-input" placeholder="KullanÄ±cÄ± AdÄ±">
            <input type="email" id="reg-email" class="auth-input" placeholder="E-Posta">
            <input type="password" id="reg-pass" class="auth-input" placeholder="Åžifre">
            <button class="auth-submit-btn" onclick="handleRegisterEmail()">KAYIT OL</button>
        </div>
    </div>

    <div class="sidebar-trigger" id="sidebar-trigger" onclick="toggleSidebar()">
        <span class="sidebar-text">TOPLULUK SOHBETÄ°</span>
    </div>
    
    <div id="chat-sidebar">
        <div class="chat-header">
            <span style="font-family: var(--font-head); color: var(--val-red);">SHRBRK FORUM</span>
            <button class="close-sidebar-btn" onclick="toggleSidebar()"><i class="fas fa-times"></i></button>
        </div>
        <div class="chat-channels">
            <button class="channel-btn active" id="btn-genel" onclick="switchChannel('genel', this)">GENEL</button>
            <button class="channel-btn" onclick="switchChannel('oyun', this)">OYUN</button>
            <button class="channel-btn" onclick="switchChannel('ekip', this)">EKÄ°P</button>
            <button class="channel-btn" id="btn-odak" onclick="switchChannel('odak', this)" style="color:var(--cyber-blue); border-color:var(--cyber-blue);">ODAK</button>
        </div>
        <div id="chat-messages" class="chat-messages">
            <div style="text-align:center; margin-top:50px; color:#666;">YÃ¼kleniyor...</div>
        </div>
        <div class="chat-input-area">
            <input type="text" id="chat-input" class="chat-input" placeholder="Mesaj gÃ¶nder..." autocomplete="off">
        </div>
    </div>

    <div class="lobby-wrapper" id="lobby-wrapper">
        <div class="lobby-container">
            <div class="lobby-card c1" onclick="openPage('p-yayin')"><div class="card-bg"></div><div class="card-info"><div class="card-title">YAYINLAR</div><div class="card-subtitle">PROGRAM</div></div></div>
            <div class="lobby-card c2" onclick="openPage('p-oyun')"><div class="card-bg"></div><div class="card-info"><div class="card-title">OYUNLAR</div><div class="card-subtitle">GEÃ‡MÄ°Åž</div></div></div>
            <div class="lobby-card c3" onclick="openPage('p-hakkinda')"><div class="card-bg"></div><div class="card-info"><div class="card-title">HAKKINDA</div><div class="card-subtitle">BÄ°Z KÄ°MÄ°Z?</div></div></div>
            <div class="lobby-card c4" onclick="openPage('p-ekipman')"><div class="card-bg"></div><div class="card-info"><div class="card-title">EKÄ°PMAN</div><div class="card-subtitle">SÄ°STEMLER</div></div></div>
            <div class="lobby-card c5" onclick="openPage('p-iletisim')"><div class="card-bg"></div><div class="card-info"><div class="card-title">Ä°LETÄ°ÅžÄ°M</div><div class="card-subtitle">CONTACT</div></div></div>
        </div>
        <button id="game-mode-toggle" onclick="toggleGameMode()">ODAK MODU</button>
    </div>

    <div class="video-trigger" id="video-trigger" onclick="toggleVideoDrawer()"><i class="fas fa-film"></i> MEDYA GALERÄ°SÄ°</div>
    <div id="video-drawer">
        <h2 style="font-family: var(--font-head); color: var(--val-red); letter-spacing: 5px;">HIGHLIGHTS</h2>
        <div class="carousel-container">
            <div class="carousel" id="carousel">
                <div class="carousel-item active"><div class="video-overlay" onclick="playVideo(this)"><i class="fas fa-play"></i></div><iframe src="https://www.youtube.com/embed/dQw4w9WgXcQ?enablejsapi=1" allowfullscreen></iframe></div>
                <div class="carousel-item"><div class="video-overlay" onclick="playVideo(this)"><i class="fas fa-play"></i></div><iframe src="https://www.youtube.com/embed/jfKfPfyJRdk?enablejsapi=1" allowfullscreen></iframe></div>
                <div class="carousel-item"><div class="video-overlay" onclick="playVideo(this)"><i class="fas fa-play"></i></div><iframe src="https://www.youtube.com/embed/5qap5aO4i9A?enablejsapi=1" allowfullscreen></iframe></div>
                <div class="carousel-item"><div class="video-overlay" onclick="playVideo(this)"><i class="fas fa-play"></i></div><iframe src="https://www.youtube.com/embed/L_jWHffIx5E?enablejsapi=1" allowfullscreen></iframe></div>
                <div class="carousel-item"><div class="video-overlay" onclick="playVideo(this)"><i class="fas fa-play"></i></div><iframe src="https://www.youtube.com/embed/3dYiK6tqE4A?enablejsapi=1" allowfullscreen></iframe></div>
            </div>
        </div>
        <div class="drawer-info" style="text-align:center; color:white; margin-top:20px;">VÄ°DEOLAR ARASINDA GEZMEK Ä°Ã‡Ä°N SCROLL YAPIN<br>[ SPACE Ä°LE KAPAT ]</div>
    </div>

    <div id="p-yayin" class="page-modal"><div class="page-content" style="color:white; text-align:center;"><h1>YAYIN PROGRAMI</h1><button class="auth-btn" onclick="closePage()">GERÄ° DÃ–N</button></div></div>
    <div id="p-oyun" class="page-modal"><div class="page-content" style="color:white; text-align:center;"><h1>OYUN GEÃ‡MÄ°ÅžÄ°</h1><button class="auth-btn" onclick="closePage()">GERÄ° DÃ–N</button></div></div>
    <div id="p-hakkinda" class="page-modal"><div class="page-content" style="color:white; text-align:center;"><h1>HAKKIMIZDA</h1><button class="auth-btn" onclick="closePage()">GERÄ° DÃ–N</button></div></div>
    <div id="p-ekipman" class="page-modal"><div class="page-content" style="color:white; text-align:center;"><h1>EKÄ°PMANLAR</h1><button class="auth-btn" onclick="closePage()">GERÄ° DÃ–N</button></div></div>
    <div id="p-iletisim" class="page-modal"><div class="page-content" style="color:white; text-align:center;"><h1>Ä°LETÄ°ÅžÄ°M</h1><button class="auth-btn" onclick="closePage()">GERÄ° DÃ–N</button></div></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
        import { getDatabase, ref, push, onValue, query, limitToLast } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-database.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, createUserWithEmailAndPassword, signInWithEmailAndPassword, updateProfile, onAuthStateChanged, signOut, setPersistence, browserLocalPersistence } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAcPdBegs8lszoK-RIgOqQvVzXIgw8GcfE",
            authDomain: "shrbrkinfo-chat.firebaseapp.com",
            projectId: "shrbrkinfo-chat",
            storageBucket: "shrbrkinfo-chat.firebasestorage.app",
            messagingSenderId: "517040954066",
            appId: "1:517040954066:web:b1ad2c4cf4ac1ea6ff6b0b",
            databaseURL: "https://shrbrkinfo-chat-default-rtdb.europe-west1.firebasedatabase.app/"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);
        setPersistence(auth, browserLocalPersistence).catch(console.error);

        const googleProvider = new GoogleAuthProvider();
        let currentUser = null;
        let currentChannel = 'genel';

        // AUTH
        window.openAuth = (type) => { document.getElementById('auth-modal-wrapper').style.display = 'flex'; document.getElementById('box-login').style.display = (type=='login'?'block':'none'); document.getElementById('box-register').style.display = (type=='register'?'block':'none'); }
        window.closeAuth = () => { document.getElementById('auth-modal-wrapper').style.display = 'none'; }
        window.handleLoginGoogle = () => { signInWithPopup(auth, googleProvider).then(()=>window.closeAuth()).catch(e => alert("Domain HatasÄ±: Firebase Console'dan Domain ekleyiniz. " + e.message)); }
        window.handleLoginEmail = async () => { try { await signInWithEmailAndPassword(auth, document.getElementById('login-email').value, document.getElementById('login-pass').value); window.closeAuth(); } catch(e){alert(e.message);} }
        window.handleRegisterEmail = async () => { try { const r = await createUserWithEmailAndPassword(auth, document.getElementById('reg-email').value, document.getElementById('reg-pass').value); await updateProfile(r.user, {displayName: document.getElementById('reg-name').value}); window.closeAuth(); } catch(e){alert(e.message);} }
        window.logoutUser = () => signOut(auth);

        onAuthStateChanged(auth, (user) => {
            currentUser = user;
            if(user) {
                document.getElementById('auth-buttons').style.display = 'none';
                document.getElementById('user-profile').style.display = 'flex';
                document.getElementById('display-name').innerText = (user.displayName || "AJAN").toUpperCase();
            } else {
                document.getElementById('auth-buttons').style.display = 'flex';
                document.getElementById('user-profile').style.display = 'none';
            }
            loadMessages();
        });

        // CHAT LOGIC
        window.switchChannel = (channel, btn) => {
            document.querySelectorAll('.channel-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            currentChannel = channel;
            loadMessages();
        }

        function loadMessages() {
            const area = document.getElementById('chat-messages');
            area.innerHTML = '<div style="text-align:center;margin-top:20px;color:#555;">...</div>';
            onValue(query(ref(db, 'forumlar/' + currentChannel), limitToLast(20)), (snap) => {
                area.innerHTML = "";
                const data = snap.val();
                if(data) Object.values(data).forEach(m => {
                    const isMine = currentUser && m.uid === currentUser.uid;
                    const d = document.createElement('div');
                    d.className = isMine ? 'msg-line mine' : 'msg-line';
                    d.innerHTML = `<div class="msg-user"><span>${m.kullanici}</span></div><div class="msg-text">${m.mesaj}</div>`;
                    area.appendChild(d);
                });
                area.scrollTop = area.scrollHeight;
            });
        }

        document.getElementById('chat-input').addEventListener('keypress', (e) => {
            if(e.key === 'Enter' && currentUser && e.target.value.trim() !== "") {
                push(ref(db, 'forumlar/' + currentChannel), { uid: currentUser.uid, kullanici: currentUser.displayName, mesaj: e.target.value });
                e.target.value = "";
            } else if(e.key === 'Enter' && !currentUser) alert("Mesaj yazmak iÃ§in giriÅŸ yapmalÄ±sÄ±n!");
        });

        // UI HELPERS
        window.toggleSidebar = () => { 
            if(isFocusMode) return; 
            document.getElementById('chat-sidebar').classList.toggle('active'); 
        };
        window.openPage = (id) => { 
            if(isFocusMode) return;
            document.getElementById(id).classList.add('active'); 
            document.getElementById('lobby-wrapper').classList.add('ui-hidden'); 
        }
        window.closePage = () => { 
            document.querySelectorAll('.page-modal').forEach(e=>e.classList.remove('active')); 
            if(!isFocusMode) document.getElementById('lobby-wrapper').classList.remove('ui-hidden'); 
        }
        
        // --- GAME MODE (ODAK MODU) ---
        let isFocusMode = false;
        let gameActive = false;
        let score = 0;
        let timeLeft = 30;
        let gameTimerInterval;
        let activeTarget = null;
        let currentDiffTime = 1450; // default orta
        
        const gameLayer = document.getElementById('game-layer');
        const hud = document.getElementById('game-hud');
        const startScreen = document.getElementById('start-screen');
        const resultScreen = document.getElementById('result-screen');
        const timeVal = document.getElementById('time-val');
        const scoreVal = document.getElementById('score-val');
        const finalScoreDisplay = document.getElementById('final-score');
        const customCursor = document.getElementById('custom-cursor');
        
        // SETTINGS ELEMENTS
        const diffSelect = document.getElementById('diff-select');
        const colorInput = document.getElementById('cross-color-input');
        const sizeInput = document.getElementById('cross-size-input');

        // YÃ¼kleme sÄ±rasÄ±nda kayÄ±tlÄ± ayarlarÄ± al
        window.addEventListener('load', () => {
            if(localStorage.getItem('shr_diff')) diffSelect.value = localStorage.getItem('shr_diff');
            if(localStorage.getItem('shr_color')) colorInput.value = localStorage.getItem('shr_color');
            if(localStorage.getItem('shr_size')) sizeInput.value = localStorage.getItem('shr_size');
            window.updateCrosshairSettings(); // Apply initial settings
        });

        // Crosshair Takibi
        document.addEventListener('mousemove', (e) => {
            if(isFocusMode) {
                customCursor.style.left = e.clientX + 'px';
                customCursor.style.top = e.clientY + 'px';
            }
            // Parallax
            const x = (e.clientX / window.innerWidth - 0.5) * 20;
            const y = (e.clientY / window.innerHeight - 0.5) * 20;
            document.getElementById('parallax-bg').style.transform = `translate(${x}px, ${y}px)`;
        });

        window.updateCrosshairSettings = () => {
            const color = colorInput.value;
            const size = sizeInput.value;
            currentDiffTime = parseInt(diffSelect.value);

            document.documentElement.style.setProperty('--cross-color', color);
            document.documentElement.style.setProperty('--cross-size', size + 'px');
            
            window.saveSettings();
        }

        window.saveSettings = () => {
            localStorage.setItem('shr_diff', diffSelect.value);
            localStorage.setItem('shr_color', colorInput.value);
            localStorage.setItem('shr_size', sizeInput.value);
            currentDiffTime = parseInt(diffSelect.value);
        }

        window.toggleGameMode = () => {
            isFocusMode = !isFocusMode;
            
            const uiElements = [
                document.getElementById('main-header'),
                document.getElementById('lobby-wrapper'),
                document.getElementById('sidebar-trigger'),
                document.getElementById('video-trigger')
            ];
            const exitBtn = document.getElementById('exit-game-mode');
            
            if(isFocusMode) {
                // Odak Modu AÃ‡ILDI
                uiElements.forEach(el => el.classList.add('ui-hidden'));
                exitBtn.style.display = 'block';
                document.body.classList.add('focus-mode');
                document.body.classList.add('game-cursor-hidden'); // GerÃ§ek mouse gizle
                customCursor.style.display = 'block'; // Ã–zel crosshair gÃ¶ster
                
                // Oyunu HazÄ±rla (Ama BaÅŸlatma)
                startScreen.style.display = 'block';
                resultScreen.style.display = 'none';
                hud.style.display = 'none';
                resetGameVars();
                
            } else {
                // Odak Modu KAPANDI
                uiElements.forEach(el => el.classList.remove('ui-hidden'));
                exitBtn.style.display = 'none';
                document.body.classList.remove('focus-mode');
                document.body.classList.remove('game-cursor-hidden'); // GerÃ§ek mouse geri getir
                customCursor.style.display = 'none'; // Crosshair gizle
                
                // Her ÅŸeyi temizle
                startScreen.style.display = 'none';
                resultScreen.style.display = 'none';
                hud.style.display = 'none';
                stopGame();
            }
        }

        function resetGameVars() {
            score = 0;
            timeLeft = 30;
            timeVal.innerText = "30";
            scoreVal.innerText = "0";
            if(activeTarget) { activeTarget.remove(); activeTarget = null; }
        }

        function stopGame() {
            gameActive = false;
            clearInterval(gameTimerInterval);
            if(activeTarget) activeTarget.remove();
        }

        window.startGame = () => {
            window.saveSettings(); // BaÅŸlamadan emin ol
            resetGameVars();
            startScreen.style.display = 'none';
            resultScreen.style.display = 'none';
            hud.style.display = 'flex';
            gameActive = true;
            
            // Ä°lk hedef
            spawnTarget();
            
            // SayaÃ§ BaÅŸlat
            gameTimerInterval = setInterval(() => {
                timeLeft--;
                timeVal.innerText = timeLeft;
                if(timeLeft <= 0) {
                    endGame();
                }
            }, 1000);
        }

        function endGame() {
            gameActive = false;
            clearInterval(gameTimerInterval);
            if(activeTarget) activeTarget.remove();
            
            hud.style.display = 'none';
            resultScreen.style.display = 'block';
            finalScoreDisplay.innerText = score;
        }

        window.shareScore = () => {
            if(!currentUser) {
                alert("Skor paylaÅŸmak iÃ§in giriÅŸ yapmalÄ±sÄ±n!");
                return;
            }
            const diffName = diffSelect.options[diffSelect.selectedIndex].text;
            
            // VeritabanÄ±na gÃ¶nder
            push(ref(db, 'forumlar/odak'), {
                uid: currentUser.uid,
                kullanici: currentUser.displayName,
                mesaj: `ðŸŽ¯ ODAK SKORU: [ ${score} ] | Zorluk: ${diffName}`,
                zaman: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
            });
            
            alert("Skorun ODAK kanalÄ±nda paylaÅŸÄ±ldÄ±!");
            
            // Odak modundan Ã§Ä±kÄ±p chati aÃ§alÄ±m ki gÃ¶rsÃ¼n
            toggleGameMode();
            setTimeout(() => {
                document.getElementById('chat-sidebar').classList.add('active');
                switchChannel('odak', document.getElementById('btn-odak'));
            }, 500);
        }

        // --- HEDEF SÄ°STEMÄ° ---
        function scheduleNextTarget() {
            if(!gameActive) return;
            // ZorluÄŸa gÃ¶re bekleme sÃ¼resi biraz deÄŸiÅŸebilir ama sabit hÄ±zlÄ± olsun
            setTimeout(spawnTarget, 200);
        }

        function spawnTarget() {
            if(!gameActive || activeTarget) return;

            const target = document.createElement('div');
            target.className = 'aim-target';
            activeTarget = target;
            
            // Animasyon sÃ¼resini JS ile ver (ZorluÄŸa gÃ¶re)
            // CSS'deki animasyonu override ediyoruz
            target.style.animation = `spawnPulse ${currentDiffTime/1000}s ease-in-out forwards`;

            // EkranÄ±n herhangi bir yeri (%5-%95)
            let x = 5 + Math.random() * 90;
            let y = 5 + Math.random() * 90;

            target.style.left = x + '%'; target.style.top = y + '%';

            target.addEventListener('mousedown', (e) => {
                e.stopPropagation(); 
                createHitEffect(e.clientX, e.clientY); 
                
                score++;
                scoreVal.innerText = score;
                
                removeTarget(); // VurulduÄŸunda sil ve yenisini getir
            });

            // SÃ¼re bitince kendiliÄŸinden silinme (Ä±skalama)
            target.addEventListener('animationend', () => {
               if(target.parentNode) {
                   // Iskalama mantÄ±ÄŸÄ± (isteÄŸe baÄŸlÄ± skor dÃ¼ÅŸÃ¼lebilir)
                   removeTarget(); 
               }
            });

            gameLayer.appendChild(target);
        }

        function removeTarget() {
            if(activeTarget) {
                activeTarget.remove();
                activeTarget = null;
                scheduleNextTarget();
            }
        }

        function createHitEffect(x, y) {
            const hit = document.createElement('div'); hit.className = 'hit-effect';
            hit.style.left = (x - 40) + 'px'; hit.style.top = (y - 40) + 'px';
            document.body.appendChild(hit); setTimeout(() => hit.remove(), 300);
        }

        // --- VIDEO DRAWER LOGIC ---
        let videoOpen = false;
        const items = document.querySelectorAll('.carousel-item');
        let idx = 0;
        window.toggleVideoDrawer = () => {
            if(isFocusMode) return;
            const d = document.getElementById('video-drawer');
            if(videoOpen) { d.classList.remove('active'); videoOpen = false; stopVideos(); }
            else { d.classList.add('active'); videoOpen = true; updateCar(); }
        }
        function updateCar() {
            const theta = 360 / items.length;
            document.getElementById('carousel').style.transform = `translateZ(-600px) rotateY(${theta * idx * -1}deg)`;
            items.forEach((it, i) => {
                it.classList.remove('active');
                let dist = Math.abs(i - (idx % items.length + items.length) % items.length);
                if(dist > items.length/2) dist = items.length - dist;
                if(dist === 0) it.classList.add('active');
                it.style.transform = `rotateY(${theta*i}deg) translateZ(600px) scale(${dist===0?1:0.8})`;
            });
        }
        function stopVideos() { items.forEach(i=>{ let f=i.querySelector('iframe'); if(f) f.contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}','*'); i.classList.remove('playing'); }); }
        
        document.addEventListener('keydown', e => { 
            if (e.key === 'Escape') { if(isFocusMode) window.toggleGameMode(); }
            if(e.code==='Space' && videoOpen && document.activeElement !== document.getElementById('chat-input')) { 
                e.preventDefault(); window.toggleVideoDrawer(); 
            } 
        });
        document.getElementById('video-drawer').addEventListener('wheel', e => { if(videoOpen){ e.preventDefault(); if(e.deltaY>0) idx++; else idx--; stopVideos(); updateCar(); }}, {passive:false});
        window.playVideo = (o) => { o.parentElement.classList.add('playing'); o.nextElementSibling.contentWindow.postMessage('{"event":"command","func":"playVideo","args":""}','*'); }
    </script>
</body>
</html>
