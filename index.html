<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHRBRK | Valorant Style Hub</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- TEMEL DEĞİŞKENLER --- */
        :root {
            --bg-color: #0f1923; 
            --bg-gradient: radial-gradient(circle at center, #1f2731 0%, #0f1923 100%);
            --val-red: #ff4655;
            --val-white: #ece8e1;
            --val-dark: #0f1923;
            --cyber-blue: #00ffff;
            --text-primary: #ece8e1;
            --text-secondary: #8b9bb4;
            --font-head: 'Orbitron', sans-serif;
            --font-body: 'Rajdhani', sans-serif;
            --sidebar-width: 350px;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg-color);
            background-image: var(--bg-gradient);
            color: var(--text-primary);
            font-family: var(--font-body);
            overflow: hidden; 
            height: 100vh;
            user-select: none;
        }

        /* --- ARKA PLAN (Motion & Particles) --- */
        #parallax-bg {
            position: fixed; top: -5%; left: -5%; width: 110%; height: 110%;
            background: url('https://images.unsplash.com/photo-1546443046-ed1ce6ffd1e9?auto=format&fit=crop&w=2070&q=80') center/cover;
            opacity: 0.15; pointer-events: none; z-index: 0;
            filter: blur(2px); transition: transform 0.1s linear;
        }

        #particles-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 1;
        }

        .particle {
            position: absolute; border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
            animation: floatParticle 10s linear infinite;
        }

        @keyframes floatParticle {
            0% { transform: translateY(100vh) scale(0); opacity: 0; }
            20% { opacity: 1; scale(1); }
            100% { transform: translateY(-10vh) scale(0.5); opacity: 0; }
        }

        /* --- HEADER --- */
        .header-container {
            position: fixed; top: 0; left: 0; width: 100%; padding: 20px 40px;
            z-index: 100; display: flex; justify-content: space-between; align-items: center;
        }

        .logo {
            font-family: var(--font-head); font-size: 2.5rem; color: var(--val-white);
            font-weight: 900; letter-spacing: 5px; text-shadow: 0 0 15px var(--val-red);
            cursor: pointer;
        }

        .top-menu { display: flex; gap: 20px; align-items: center; }
        .menu-link {
            color: var(--text-secondary); text-decoration: none; font-family: var(--font-head);
            font-size: 0.8rem; letter-spacing: 2px; transition: 0.3s; position: relative;
        }
        .menu-link:hover { color: var(--val-white); }

        /* Auth Butonları */
        .auth-btn {
            background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);
            color: var(--val-white); padding: 8px 20px; font-family: var(--font-head);
            font-size: 0.8rem; cursor: pointer; transition: 0.3s;
            clip-path: polygon(10px 0, 100% 0, 100% 100%, 0 100%, 0 10px);
        }
        .auth-btn:hover { background: var(--val-white); color: #000; }
        .auth-btn.primary { background: var(--val-red); border-color: var(--val-red); }
        .auth-btn.primary:hover { background: #ff7070; color: #fff; }

        /* User Profile */
        #user-profile { display: none; align-items: center; gap: 15px; }
        .user-name { color: var(--cyber-blue); font-family: var(--font-head); font-size: 0.9rem; }
        .logout-icon { cursor: pointer; color: var(--val-red); font-size: 1.1rem; transition: 0.3s; }
        .logout-icon:hover { transform: scale(1.2); }

        /* --- MAIN LOBBY (VALORANT STYLE) --- */
        .lobby-container {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            display: flex; gap: 15px; z-index: 10;
            height: 60vh; width: 80vw;
            justify-content: center; align-items: center;
            perspective: 1000px;
        }

        .lobby-card {
            flex: 1; height: 100%; max-width: 250px;
            position: relative; cursor: pointer;
            transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94), filter 0.4s;
            clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
            background: rgba(30, 40, 50, 0.6);
            border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            overflow: hidden;
            display: flex; flex-direction: column; justify-content: flex-end;
        }

        .lobby-card:hover {
            transform: scale(1.1) translateY(-20px);
            z-index: 20;
            border-color: var(--val-red);
            box-shadow: 0 0 30px rgba(255, 70, 85, 0.3);
        }

        .lobby-card:not(:hover) { filter: brightness(0.7); }

        .card-bg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover; background-position: center;
            transition: transform 0.5s; z-index: -1;
        }
        .lobby-card:hover .card-bg { transform: scale(1.1); }

        /* Görseller */
        .c1 .card-bg { background-image: url('https://cmsassets.rgpub.io/sanity/images/dsfx7636/news/e435c3378b7999a3338b408dbb5da8ba63f91150-616x822.png?accountingTag=VAL?auto=format&fit=fill&q=80&w=352'); }
        .c2 .card-bg { background-image: url('https://cmsassets.rgpub.io/sanity/images/dsfx7636/news/477284dfe402a85abcf6b07512bcd6f01c8fe60e-616x822.png?accountingTag=VAL?auto=format&fit=fill&q=80&w=352'); }
        .c3 .card-bg { background-image: url('https://cmsassets.rgpub.io/sanity/images/dsfx7636/news/14145d7bf9be17afa80c04ee4fbe200076cc1769-616x822.png?accountingTag=VAL?auto=format&fit=fill&q=80&w=352'); }
        .c4 .card-bg { background-image: url('https://cmsassets.rgpub.io/sanity/images/dsfx7636/news/7cb513c9b3eae3286449776e85753138436d553c-616x822.png?accountingTag=VAL?auto=format&fit=fill&q=80&w=352'); }
        .c5 .card-bg { background-image: url('https://cmsassets.rgpub.io/sanity/images/dsfx7636/news/47387e354c34d51b84066bc47af3c5755b92b9c5-616x822.png?accountingTag=VAL?auto=format&fit=fill&q=80&w=352'); }

        .card-info {
            background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
            padding: 20px; text-align: center; width: 100%;
        }
        .card-title {
            font-family: var(--font-head); font-size: 1.2rem; color: var(--val-white);
            text-transform: uppercase; letter-spacing: 2px;
        }
        .card-subtitle { font-size: 0.8rem; color: var(--val-red); margin-top: 5px; font-weight: bold; }

        /* --- SOL SOHBET ÇEKMECESİ (LEFT DRAWER) --- */
        .sidebar-trigger {
            position: fixed; left: 0; top: 50%; transform: translateY(-50%);
            width: 40px; height: 300px; background: rgba(0,0,0,0.6);
            border: 1px solid rgba(255,255,255,0.1); border-left: none;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; z-index: 2000; transition: 0.3s;
            clip-path: polygon(0 0, 100% 10%, 100% 90%, 0 100%);
        }
        .sidebar-trigger:hover { background: var(--val-red); width: 50px; }
        .sidebar-text { writing-mode: vertical-rl; transform: rotate(180deg); font-family: var(--font-head); letter-spacing: 3px; color: #fff; }

        #chat-sidebar {
            position: fixed; top: 0; left: -400px; /* Başlangıçta gizli */
            width: var(--sidebar-width); height: 100%;
            background: rgba(15, 25, 35, 0.98);
            border-right: 1px solid var(--val-red);
            backdrop-filter: blur(20px);
            z-index: 2001; transition: left 0.4s cubic-bezier(0.19, 1, 0.22, 1);
            display: flex; flex-direction: column;
        }
        #chat-sidebar.active { left: 0; }

        .chat-header {
            padding: 20px; background: rgba(255, 70, 85, 0.1);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex; justify-content: space-between; align-items: center;
        }
        .chat-channels {
            display: flex; padding: 10px; gap: 10px; overflow-x: auto;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .channel-btn {
            background: transparent; border: 1px solid rgba(255,255,255,0.2);
            color: #aaa; padding: 5px 10px; font-size: 0.8rem; cursor: pointer;
            white-space: nowrap; transition: 0.2s; font-family: var(--font-head);
        }
        .channel-btn.active, .channel-btn:hover { background: var(--val-red); color: #fff; border-color: var(--val-red); }

        .chat-messages { flex: 1; padding: 20px; overflow-y: auto; color: #ddd; font-size: 0.9rem; display: flex; flex-direction: column; gap: 10px;}
        
        /* Mesaj Balonları */
        .msg-line { padding: 8px 12px; background: rgba(255,255,255,0.05); border-left: 2px solid #555; }
        .msg-line.mine { border-left-color: var(--cyber-blue); background: rgba(0, 255, 255, 0.05); }
        .msg-user { font-size: 0.75rem; color: var(--val-red); font-weight: bold; margin-bottom: 3px; display:flex; justify-content:space-between;}
        .msg-line.mine .msg-user { color: var(--cyber-blue); }
        .msg-text { font-size: 0.9rem; color: #eee; word-wrap: break-word;}

        .chat-input-area { padding: 20px; border-top: 1px solid rgba(255,255,255,0.1); position: relative; }
        .chat-input { width: 100%; padding: 12px; background: rgba(0,0,0,0.3); border: 1px solid #555; color: #fff; outline: none; font-family: var(--font-body); }
        .chat-input:focus { border-color: var(--val-red); }
        
        .login-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 25, 35, 0.9); display: flex; align-items: center; justify-content: center;
            font-family: var(--font-head); color: #aaa; font-size: 0.8rem; cursor: pointer;
        }
        .login-overlay:hover { color: var(--val-white); }

        .close-sidebar-btn { background: transparent; border: none; color: #fff; font-size: 1.2rem; cursor: pointer; }

        /* --- AUTH MODALS (LOGIN / REGISTER) --- */
        .auth-modal-wrapper {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 5000; display: none;
            justify-content: center; align-items: center; backdrop-filter: blur(5px);
        }
        .auth-box {
            background: rgba(20, 25, 35, 0.95); width: 350px; padding: 40px;
            border: 1px solid var(--val-red); position: relative;
            clip-path: polygon(20px 0, 100% 0, 100% calc(100% - 20px), calc(100% - 20px) 100%, 0 100%, 0 20px);
            box-shadow: 0 0 30px rgba(255, 70, 85, 0.2);
            text-align: center;
        }
        .auth-title { font-family: var(--font-head); color: var(--val-white); font-size: 1.5rem; margin-bottom: 20px; letter-spacing: 2px; }
        .auth-input {
            width: 100%; padding: 12px; margin-bottom: 15px; background: rgba(0,0,0,0.5);
            border: 1px solid #444; color: #fff; font-family: var(--font-body);
        }
        .auth-input:focus { border-color: var(--val-red); outline: none; }
        
        .auth-submit-btn {
            width: 100%; padding: 12px; background: var(--val-red); color: #fff;
            border: none; font-family: var(--font-head); cursor: pointer; transition: 0.2s;
            clip-path: polygon(10px 0, 100% 0, 100% 100%, 0 100%, 0 10px);
        }
        .auth-submit-btn:hover { background: #ff7070; }
        
        .google-btn {
            width: 100%; padding: 12px; margin-top: 10px; background: #fff; color: #333;
            border: none; font-family: var(--font-head); cursor: pointer; transition: 0.2s;
            display: flex; align-items: center; justify-content: center; gap: 10px;
            clip-path: polygon(10px 0, 100% 0, 100% 100%, 0 100%, 0 10px);
        }
        .google-btn:hover { background: #ddd; }

        .auth-close { position: absolute; top: 10px; right: 15px; color: #555; cursor: pointer; font-size: 1.2rem; }
        .auth-close:hover { color: #fff; }

        /* --- VİDEO GALERİ & DİĞERLERİ (AYNEN KORUNDU) --- */
        .video-trigger {
            position: fixed; bottom: 0; left: 50%; transform: translateX(-50%);
            padding: 10px 40px; background: rgba(0,0,0,0.8);
            border: 1px solid var(--val-red); border-bottom: none;
            color: var(--val-white); font-family: var(--font-head);
            cursor: pointer; z-index: 90; clip-path: polygon(10% 0, 90% 0, 100% 100%, 0 100%);
            transition: 0.3s;
        }
        .video-trigger:hover { background: var(--val-red); padding-bottom: 15px; }

        #video-drawer {
            position: fixed; bottom: -100vh; left: 0; width: 100%; height: 90vh;
            background: rgba(10, 12, 16, 0.98); z-index: 3000;
            transition: bottom 0.6s cubic-bezier(0.23, 1, 0.32, 1);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            border-top: 2px solid var(--val-red);
        }
        #video-drawer.active { bottom: 0; }

        .carousel-container { width: 100%; height: 60vh; perspective: 1500px; display: flex; justify-content: center; align-items: center; }
        .carousel { position: relative; width: 600px; height: 350px; transform-style: preserve-3d; transition: transform 0.6s; }
        .carousel-item {
            position: absolute; width: 600px; height: 350px; left: 0; top: 0;
            background: #000; border: 2px solid #333; transition: 0.6s; opacity: 0.3; filter: grayscale(100%); pointer-events: none;
        }
        .carousel-item.active { opacity: 1; filter: grayscale(0%); pointer-events: auto; border-color: var(--val-red); box-shadow: 0 0 50px rgba(255, 70, 85, 0.2); }
        .carousel-item iframe { width: 100%; height: 100%; border: none; }
        .video-overlay {
            position: absolute; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.6); display: flex; justify-content: center; align-items: center;
            font-size: 3rem; color: #fff; cursor: pointer; z-index: 5; transition: 0.3s;
        }
        .carousel-item.active:hover .video-overlay { background: rgba(0,0,0,0.3); color: var(--val-red); }
        .carousel-item.playing .video-overlay { opacity: 0; pointer-events: none; }

        .drawer-info { text-align: center; margin-top: 20px; font-family: var(--font-head); color: #fff; }
        .close-hint { font-size: 0.8rem; color: #777; margin-top: 10px; letter-spacing: 2px; }

        /* --- CONTENT PAGES --- */
        .page-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(10,10,15,0.95); z-index: 4000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none; transition: 0.4s;
        }
        .page-modal.active { opacity: 1; pointer-events: auto; }
        .page-content { text-align: center; max-width: 800px; }
        .back-btn {
            margin-top: 30px; padding: 10px 40px; background: transparent;
            border: 1px solid var(--val-red); color: var(--val-red);
            font-family: var(--font-head); cursor: pointer; transition: 0.3s;
        }
        .back-btn:hover { background: var(--val-red); color: #fff; }

        .blur-bg { filter: blur(8px); transition: 0.3s; }

    </style>
</head>
<body>

    <div id="parallax-bg"></div>
    <div id="particles-container"></div>

    <div class="header-container" id="main-header">
        <div class="logo">SHRBRK</div>
        <div class="top-menu">
            <a href="https://kick.com/shrbrk" class="menu-link">KICK</a>
            <a href="https://instagram.com/shrbrkofficial" class="menu-link">INSTAGRAM</a>
            
            <div id="auth-buttons" style="display:flex; gap:10px;">
                <button class="auth-btn" onclick="openAuth('login')">GİRİŞ YAP</button>
                <button class="auth-btn primary" onclick="openAuth('register')">KAYIT OL</button>
            </div>

            <div id="user-profile">
                <span class="user-name" id="display-name">KULLANICI</span>
                <i class="fas fa-sign-out-alt logout-icon" onclick="logoutUser()" title="Çıkış Yap"></i>
            </div>
        </div>
    </div>

    <div id="auth-modal-wrapper" class="auth-modal-wrapper">
        <div id="box-login" class="auth-box" style="display:none;">
            <i class="fas fa-times auth-close" onclick="closeAuth()"></i>
            <div class="auth-title">SİSTEME GİRİŞ</div>
            <input type="email" id="login-email" class="auth-input" placeholder="E-Posta Adresi">
            <input type="password" id="login-pass" class="auth-input" placeholder="Şifre">
            <button class="auth-submit-btn" onclick="handleLoginEmail()">GİRİŞ YAP</button>
            <button class="google-btn" onclick="handleLoginGoogle()"><i class="fab fa-google"></i> GOOGLE İLE GİRİŞ</button>
        </div>

        <div id="box-register" class="auth-box" style="display:none;">
            <i class="fas fa-times auth-close" onclick="closeAuth()"></i>
            <div class="auth-title" style="color:var(--cyber-blue);">YENİ AJAN KAYDI</div>
            <input type="text" id="reg-name" class="auth-input" placeholder="Kullanıcı Adı (Ajan Kodu)">
            <input type="email" id="reg-email" class="auth-input" placeholder="E-Posta">
            <input type="password" id="reg-pass" class="auth-input" placeholder="Şifre (Min 6 Karakter)">
            <button class="auth-submit-btn" style="background:var(--cyber-blue); color:#000;" onclick="handleRegisterEmail()">KAYIT OL</button>
        </div>
    </div>

    <div class="sidebar-trigger" onclick="toggleSidebar()">
        <span class="sidebar-text">TOPLULUK SOHBETİ</span>
    </div>

    <div id="chat-sidebar">
        <div class="chat-header">
            <span style="font-family: var(--font-head); color: var(--val-red);">SHRBRK FORUM</span>
            <button class="close-sidebar-btn" onclick="toggleSidebar()"><i class="fas fa-times"></i></button>
        </div>
        <div class="chat-channels">
            <button class="channel-btn active" onclick="switchChannel('genel', this)">GENEL</button>
            <button class="channel-btn" onclick="switchChannel('oyun', this)">OYUN</button>
            <button class="channel-btn" onclick="switchChannel('ekip', this)">EKİP</button>
        </div>
        
        <div class="chat-messages" id="chat-messages">
            <div style="text-align:center; margin-top:50px; color:#666;">Yükleniyor...</div>
        </div>

        <div class="chat-input-area">
            <div id="chat-lock-overlay" class="login-overlay" onclick="toggleSidebar(); openAuth('login');">
                <i class="fas fa-lock"></i> &nbsp; YAZMAK İÇİN GİRİŞ YAP
            </div>
            <input type="text" id="chat-input" class="chat-input" placeholder="Mesaj gönder..." autocomplete="off">
        </div>
    </div>

    <div class="lobby-container" id="lobby-container">
        <div class="lobby-card c1" onclick="openPage('p-yayin')"><div class="card-bg"></div><div class="card-info"><div class="card-title">YAYINLAR</div><div class="card-subtitle">PROGRAM</div></div></div>
        <div class="lobby-card c2" onclick="openPage('p-oyun')"><div class="card-bg"></div><div class="card-info"><div class="card-title">OYUNLAR</div><div class="card-subtitle">GEÇMİŞ</div></div></div>
        <div class="lobby-card c3" onclick="openPage('p-hakkinda')"><div class="card-bg"></div><div class="card-info"><div class="card-title">HAKKINDA</div><div class="card-subtitle">BİZ KİMİZ?</div></div></div>
        <div class="lobby-card c4" onclick="openPage('p-ekipman')"><div class="card-bg"></div><div class="card-info"><div class="card-title">EKİPMAN</div><div class="card-subtitle">SİSTEMLER</div></div></div>
        <div class="lobby-card c5" onclick="openPage('p-iletisim')"><div class="card-bg"></div><div class="card-info"><div class="card-title">İLETİŞİM</div><div class="card-subtitle">CONTACT</div></div></div>
    </div>

    <div class="video-trigger" onclick="toggleVideoDrawer()"><i class="fas fa-film"></i> MEDYA GALERİSİ</div>
    <div id="video-drawer">
        <h2 style="font-family: var(--font-head); color: var(--val-red); letter-spacing: 5px;">HIGHLIGHTS</h2>
        <div class="carousel-container" id="carousel-wrapper">
            <div class="carousel" id="carousel">
                <div class="carousel-item"><div class="video-overlay" onclick="playVideo(this)"><i class="fas fa-play"></i></div><iframe src="https://www.youtube.com/embed/dQw4w9WgXcQ?enablejsapi=1" allowfullscreen></iframe></div>
                <div class="carousel-item"><div class="video-overlay" onclick="playVideo(this)"><i class="fas fa-play"></i></div><iframe src="https://www.youtube.com/embed/jfKfPfyJRdk?enablejsapi=1" allowfullscreen></iframe></div>
                <div class="carousel-item"><div class="video-overlay" onclick="playVideo(this)"><i class="fas fa-play"></i></div><iframe src="https://www.youtube.com/embed/5qap5aO4i9A?enablejsapi=1" allowfullscreen></iframe></div>
                <div class="carousel-item"><div class="video-overlay" onclick="playVideo(this)"><i class="fas fa-play"></i></div><iframe src="https://www.youtube.com/embed/L_jWHffIx5E?enablejsapi=1" allowfullscreen></iframe></div>
                <div class="carousel-item"><div class="video-overlay" onclick="playVideo(this)"><i class="fas fa-play"></i></div><iframe src="https://www.youtube.com/embed/3dYiK6tqE4A?enablejsapi=1" allowfullscreen></iframe></div>
            </div>
        </div>
        <div class="drawer-info"><div>VİDEOLAR ARASINDA GEZMEK İÇİN SCROLL YAPIN</div><div class="close-hint">[ KAPATMAK İÇİN SPACE TUŞUNA BASIN ]</div></div>
    </div>

    <div id="p-yayin" class="page-modal"><div class="page-content"><h1 style="color:var(--val-red); font-family:var(--font-head);">YAYIN PROGRAMI</h1><p>Hafta içi her akşam 20:00'da.</p><button class="back-btn" onclick="closePage()">GERİ DÖN</button></div></div>
    <div id="p-oyun" class="page-modal"><div class="page-content"><h1>OYUN GEÇMİŞİ</h1><p>Valorant: Ascendant<br>LoL: Diamond</p><button class="back-btn" onclick="closePage()">GERİ DÖN</button></div></div>
    <div id="p-hakkinda" class="page-modal"><div class="page-content"><h1>HAKKIMIZDA</h1><p>Biz Seher ve Burak.</p><button class="back-btn" onclick="closePage()">GERİ DÖN</button></div></div>
    <div id="p-ekipman" class="page-modal"><div class="page-content"><h1>EKİPMANLAR</h1><p>RTX 4080 Super Sistemler</p><button class="back-btn" onclick="closePage()">GERİ DÖN</button></div></div>
    <div id="p-iletisim" class="page-modal"><div class="page-content"><h1>İLETİŞİM</h1><p>shrbrk@outlook.com</p><button class="back-btn" onclick="closePage()">GERİ DÖN</button></div></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
        import { getDatabase, ref, push, onValue, query, limitToLast } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-database.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, createUserWithEmailAndPassword, signInWithEmailAndPassword, updateProfile, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAcPdBegs8lszoK-RIgOqQvVzXIgw8GcfE",
            authDomain: "shrbrkinfo-chat.firebaseapp.com",
            projectId: "shrbrkinfo-chat",
            storageBucket: "shrbrkinfo-chat.firebasestorage.app",
            messagingSenderId: "517040954066",
            appId: "1:517040954066:web:b1ad2c4cf4ac1ea6ff6b0b",
            databaseURL: "https://shrbrkinfo-chat-default-rtdb.europe-west1.firebasedatabase.app/"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);
        const googleProvider = new GoogleAuthProvider();

        let currentUser = null;
        let currentChannel = 'genel';

        // --- AUTH UI YÖNETİMİ ---
        window.openAuth = (type) => {
            document.getElementById('auth-modal-wrapper').style.display = 'flex';
            document.getElementById('lobby-container').classList.add('blur-bg');
            document.getElementById('box-login').style.display = 'none';
            document.getElementById('box-register').style.display = 'none';
            document.getElementById('box-' + type).style.display = 'block';
        }
        window.closeAuth = () => {
            document.getElementById('auth-modal-wrapper').style.display = 'none';
            document.getElementById('lobby-container').classList.remove('blur-bg');
        }

        // --- AUTH İŞLEMLERİ ---
        window.handleRegisterEmail = async () => {
            const name = document.getElementById('reg-name').value;
            const email = document.getElementById('reg-email').value;
            const pass = document.getElementById('reg-pass').value;
            if(!name || !email || !pass) return alert("Tüm alanları doldurun!");

            try {
                const res = await createUserWithEmailAndPassword(auth, email, pass);
                await updateProfile(res.user, { displayName: name });
                alert("Kayıt Başarılı! Hoşgeldin Ajan " + name);
                window.closeAuth();
            } catch(e) { alert("Hata: " + e.message); }
        }

        window.handleLoginEmail = async () => {
            const email = document.getElementById('login-email').value;
            const pass = document.getElementById('login-pass').value;
            try {
                await signInWithEmailAndPassword(auth, email, pass);
                window.closeAuth();
            } catch(e) { alert("Giriş Başarısız: " + e.message); }
        }

        window.handleLoginGoogle = () => {
            signInWithPopup(auth, googleProvider).then(() => window.closeAuth()).catch(e => alert(e.message));
        }

        window.logoutUser = () => signOut(auth);

        // --- KULLANICI DURUM TAKİBİ ---
        onAuthStateChanged(auth, (user) => {
            currentUser = user;
            if (user) {
                // Giriş Yapıldı
                document.getElementById('auth-buttons').style.display = 'none';
                document.getElementById('user-profile').style.display = 'flex';
                document.getElementById('display-name').innerText = (user.displayName || user.email).toUpperCase();
                document.getElementById('chat-lock-overlay').style.display = 'none'; // Kilidi kaldır
            } else {
                // Çıkış Yapıldı
                document.getElementById('auth-buttons').style.display = 'flex';
                document.getElementById('user-profile').style.display = 'none';
                document.getElementById('chat-lock-overlay').style.display = 'flex'; // Kilidi koy
            }
            loadMessages(); // Mesajları duruma göre (veya kanal değişimine göre) yükle
        });

        // --- CHAT SİSTEMİ ---
        window.switchChannel = (channel, btn) => {
            document.querySelectorAll('.channel-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            currentChannel = channel;
            loadMessages();
        }

        function loadMessages() {
            const area = document.getElementById('chat-messages');
            area.innerHTML = '<div style="text-align:center; margin-top:20px; color:#555;">Veriler alınıyor...</div>';
            
            const chatRef = query(ref(db, 'forumlar/' + currentChannel), limitToLast(30));
            onValue(chatRef, (snapshot) => {
                area.innerHTML = "";
                const data = snapshot.val();
                if(data) {
                    Object.values(data).forEach(msg => {
                        const div = document.createElement('div');
                        const isMine = currentUser && msg.uid === currentUser.uid;
                        div.className = isMine ? 'msg-line mine' : 'msg-line';
                        
                        div.innerHTML = `
                            <div class="msg-user">
                                <span>${msg.kullanici}</span>
                                <span style="font-size:0.6rem; color:#666;">${msg.zaman}</span>
                            </div>
                            <div class="msg-text">${msg.mesaj}</div>
                        `;
                        area.appendChild(div);
                    });
                    area.scrollTop = area.scrollHeight;
                } else {
                    area.innerHTML = '<div style="text-align:center; margin-top:20px; color:#555;">Bu kanalda henüz mesaj yok.</div>';
                }
            });
        }

        // Mesaj Gönderme
        document.getElementById('chat-input').addEventListener('keypress', (e) => {
            if(e.key === 'Enter' && currentUser) {
                const txt = e.target.value;
                if(txt.trim() === "") return;
                
                push(ref(db, 'forumlar/' + currentChannel), {
                    uid: currentUser.uid,
                    kullanici: currentUser.displayName || "Anonim",
                    mesaj: txt,
                    zaman: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
                });
                e.target.value = "";
            }
        });

        // --- UI HELPER FUNCTIONS ---
        // (Modül dışına aktarılması gereken fonksiyonlar)
        window.toggleSidebar = () => document.getElementById('chat-sidebar').classList.toggle('active');
        window.openPage = (id) => {
            document.getElementById(id).classList.add('active');
            document.getElementById('lobby-container').classList.add('blur-bg');
        }
        window.closePage = () => {
            document.querySelectorAll('.page-modal').forEach(el => el.classList.remove('active'));
            document.getElementById('lobby-container').classList.remove('blur-bg');
        }

        // Video Carousel Logic
        let videoDrawerOpen = false;
        const carousel = document.getElementById('carousel');
        const items = document.querySelectorAll('.carousel-item');
        let selectedIndex = 0;
        const radius = 600; const theta = 360 / items.length;

        window.toggleVideoDrawer = () => {
            const d = document.getElementById('video-drawer');
            if(videoDrawerOpen) { d.classList.remove('active'); videoDrawerOpen = false; stopAllVideos(); }
            else { d.classList.add('active'); videoDrawerOpen = true; updateCarousel(); }
        }

        function updateCarousel() {
            const angle = theta * selectedIndex * -1;
            carousel.style.transform = 'translateZ(' + -radius + 'px) rotateY(' + angle + 'deg)';
            let activeIndex = selectedIndex % items.length;
            if (activeIndex < 0) activeIndex += items.length;
            items.forEach((item, index) => {
                item.classList.remove('active');
                let dist = Math.abs(index - activeIndex);
                if (dist > items.length / 2) dist = items.length - dist;
                let tStr = `rotateY(${theta * index}deg) translateZ(${radius}px)`;
                if (dist === 0) { item.style.transform = tStr + ' scale(1.0)'; item.classList.add('active'); }
                else { item.style.transform = tStr + ' scale(0.8)'; resetVideo(item); }
            });
        }

        window.playVideo = (overlay) => {
            overlay.parentElement.classList.add('playing');
            overlay.nextElementSibling.contentWindow.postMessage('{"event":"command","func":"playVideo","args":""}', '*');
        }
        function resetVideo(item) {
            item.classList.remove('playing');
            let f = item.querySelector('iframe');
            if(f) f.contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}', '*');
        }
        function stopAllVideos() { items.forEach(item => resetVideo(item)); }

        document.getElementById('video-drawer').addEventListener('wheel', (e) => {
            if(!videoDrawerOpen) return;
            e.preventDefault();
            if (e.deltaY > 0) selectedIndex++; else selectedIndex--;
            stopAllVideos(); updateCarousel();
        }, { passive: false });

        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' && videoDrawerOpen) { e.preventDefault(); window.toggleVideoDrawer(); }
        });
        
        // Particles
        const pc = document.getElementById('particles-container');
        for(let i=0; i<30; i++) {
            let p = document.createElement('div'); p.className = 'particle';
            let s = Math.random() * 5 + 2; p.style.width = s+'px'; p.style.height = s+'px';
            p.style.left = Math.random()*100 + '%'; p.style.animationDuration = (Math.random()*5 + 5) + 's';
            pc.appendChild(p);
        }
        document.addEventListener('mousemove', (e) => {
            const x = (e.clientX / window.innerWidth - 0.5) * 20;
            const y = (e.clientY / window.innerHeight - 0.5) * 20;
            document.getElementById('parallax-bg').style.transform = `translate(${x}px, ${y}px)`;
        });

    </script>
</body>
</html>
